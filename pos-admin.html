<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POS Admin</title>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<style>
:root{
  --bg:#f4f5f7;--bg-card:#fff;--bg-panel:#fafafa;--bg-input:#f0f1f3;
  --border:#e2e4e8;--border-light:#eef0f2;
  --primary:#2563eb;--primary-dark:#1d4ed8;--primary-light:#dbeafe;
  --text:#1a1a2e;--text-dim:#64748b;--text-faint:#94a3b8;
  --danger:#ef4444;--danger-light:#fef2f2;
  --success:#22c55e;--success-light:#f0fdf4;
  --info:#3b82f6;--info-light:#eff6ff;
  --font-display:'Outfit',system-ui,sans-serif;
  --font-mono:'JetBrains Mono',monospace;
}
*{margin:0;padding:0;box-sizing:border-box}
body{min-height:100vh;background:var(--bg);font-family:var(--font-display);color:var(--text)}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}

.header{background:var(--bg-card);border-bottom:1px solid var(--border);padding:10px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
.header-brand{display:flex;align-items:center;gap:10px}
.hdr-logo{width:36px;height:36px;border-radius:8px;object-fit:cover;border:1px solid var(--border)}
.header-title{font-size:18px;font-weight:800;color:var(--primary);letter-spacing:.5px}
.header-sub{font-size:9px;color:var(--text-faint);font-family:var(--font-mono);letter-spacing:2px;text-transform:uppercase}
.header-nav{display:flex;gap:4px}
.nav-btn{padding:8px 14px;background:transparent;color:var(--text-dim);border:1px solid transparent;border-radius:8px;cursor:pointer;font-family:var(--font-display);font-weight:500;font-size:12px;transition:all .2s}
.nav-btn:hover{background:var(--bg)}
.nav-btn.active{background:var(--primary);color:#fff;font-weight:700;border-color:var(--primary)}
.header-date{font-family:var(--font-mono);font-size:11px;color:var(--text-dim);text-align:right}
.header-date small{color:var(--text-faint);font-size:10px;display:block;margin-top:2px}
.sync-dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:4px;background:#ef4444}
.sync-dot.on{background:#22c55e;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}

.pos-layout{display:flex;height:calc(100vh - 57px)}
.products-panel{flex:1;padding:20px;overflow:auto}
.order-panel{width:380px;background:var(--bg-card);border-left:1px solid var(--border);display:flex;flex-direction:column}

.search-input{width:100%;padding:10px 14px;background:var(--bg-input);border:1px solid var(--border-light);border-radius:10px;color:var(--text);font-size:14px;font-family:var(--font-display);outline:none;margin-bottom:14px}
.search-input:focus{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,0.1)}.search-input::placeholder{color:var(--text-faint)}

.categories{display:flex;gap:6px;margin-bottom:14px;flex-wrap:wrap}
.cat-btn{padding:7px 14px;background:var(--bg-card);color:var(--text-dim);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-family:var(--font-display);font-weight:600;font-size:12px;transition:all .2s}
.cat-btn:hover{border-color:var(--primary);color:var(--primary)}
.cat-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

.product-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(195px,1fr));gap:10px}
.product-card{background:var(--bg-card);border:1px solid var(--border-light);border-radius:12px;padding:14px;transition:all .15s;box-shadow:0 1px 2px rgba(0,0,0,0.03)}
.product-card:hover{border-color:var(--primary);box-shadow:0 4px 12px rgba(37,99,235,0.08);transform:translateY(-1px)}
.product-top{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}
.product-name{font-weight:600;font-size:14px}.product-price{font-size:11px;color:var(--text-dim);font-family:var(--font-mono);margin-top:2px}
.unit-badge{font-size:10px;padding:2px 8px;border-radius:4px;font-family:var(--font-mono);font-weight:600}
.unit-badge.kg{background:var(--success-light);color:#16a34a}.unit-badge.pza{background:var(--info-light);color:#2563eb}
.product-actions{display:flex;gap:6px;align-items:center}
.qty-input{flex:1;padding:8px 10px;background:var(--bg-input);border:1px solid var(--border-light);border-radius:6px;color:var(--text);font-size:13px;font-family:var(--font-mono);outline:none;width:60px}
.qty-input:focus{border-color:var(--primary)}
.add-btn{padding:8px 14px;background:var(--primary);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:700;font-size:16px}
.add-btn:hover{background:var(--primary-dark)}

.order-header{padding:14px 18px;border-bottom:1px solid var(--border-light);font-size:15px;font-weight:700;display:flex;justify-content:space-between;align-items:center}
.order-count{background:var(--primary-light);color:var(--primary);padding:4px 10px;border-radius:12px;font-size:11px;font-family:var(--font-mono);font-weight:700}
.order-items{flex:1;overflow:auto;padding:8px 12px}
.order-empty{text-align:center;padding:60px 20px;color:var(--text-faint)}
.order-item{background:var(--bg);border:1px solid var(--border-light);border-radius:10px;padding:12px;margin-bottom:6px}
.order-item-top{display:flex;justify-content:space-between;align-items:flex-start}
.order-item-name{font-weight:600;font-size:13px}.order-item-price{font-size:10px;color:var(--text-dim);font-family:var(--font-mono);margin-top:2px}
.remove-btn{background:var(--danger-light);color:var(--danger);border:none;border-radius:6px;padding:4px 8px;cursor:pointer;font-size:11px;font-weight:700}
.order-item-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
.qty-controls{display:flex;align-items:center;gap:6px}
.qty-ctrl-btn{width:28px;height:28px;border-radius:6px;background:var(--bg-card);color:var(--text);border:1px solid var(--border);cursor:pointer;font-size:14px;font-weight:700}
.qty-ctrl-btn:hover{border-color:var(--primary);color:var(--primary)}
.qty-edit{width:60px;text-align:center;padding:4px;background:var(--bg-input);border:1px solid var(--border-light);border-radius:6px;color:var(--primary);font-size:13px;font-family:var(--font-mono);font-weight:600;outline:none}
.qty-unit{font-size:11px;color:var(--text-faint)}
.order-item-total{font-family:var(--font-mono);font-weight:700;font-size:14px;color:var(--primary)}

.totals-section{padding:14px 18px;background:var(--bg-panel);border-top:1px solid var(--border)}
.total-row{display:flex;justify-content:space-between;margin-bottom:4px;font-family:var(--font-mono);font-size:12px;color:var(--text-dim)}
.total-grand{display:flex;justify-content:space-between;font-size:22px;font-weight:800;color:var(--primary);border-top:2px solid var(--primary-light);padding-top:10px;margin-top:8px}
.action-buttons{display:flex;gap:8px;margin-top:12px}
.btn-cancel{flex:1;padding:11px;background:var(--danger-light);color:var(--danger);border:none;border-radius:10px;cursor:pointer;font-weight:600;font-size:13px}
.btn-cancel:disabled{background:var(--bg-input);color:var(--text-faint);cursor:not-allowed}
.btn-charge{flex:2;padding:13px;background:var(--primary);color:#fff;border:none;border-radius:10px;cursor:pointer;font-weight:800;font-size:15px;letter-spacing:.5px}
.btn-charge:disabled{background:var(--bg-input);color:var(--text-faint);cursor:not-allowed}

.scroll-view{padding:24px;max-width:960px;margin:0 auto}
.view-title{font-size:22px;font-weight:800;margin-bottom:18px;display:flex;justify-content:space-between;align-items:center}
.view-title .count{font-size:12px;font-weight:500;color:var(--text-dim);font-family:var(--font-mono)}

.sale-card{background:var(--bg-card);border:1px solid var(--border-light);border-radius:12px;padding:16px;margin-bottom:8px;cursor:pointer;transition:all .15s;display:flex;justify-content:space-between;align-items:center;box-shadow:0 1px 2px rgba(0,0,0,0.03)}
.sale-card:hover{border-color:var(--primary);box-shadow:0 4px 12px rgba(37,99,235,0.06)}
.sale-folio{font-family:var(--font-mono);font-weight:700;font-size:13px;color:var(--primary)}
.sale-date{font-family:var(--font-mono);font-size:11px;color:var(--text-faint);margin-top:2px}
.sale-products{font-size:12px;color:var(--text-dim);margin-top:6px;max-width:420px}
.sale-total{font-size:20px;font-weight:800;color:var(--primary);text-align:right}
.sale-view-link{font-size:11px;color:var(--info);margin-top:4px;text-align:right}

.admin-section{background:var(--bg-card);border:1px solid var(--border-light);border-radius:14px;padding:20px;margin-bottom:18px;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.admin-section-title{font-size:15px;font-weight:700;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border-light);display:flex;justify-content:space-between;align-items:center}
.form-row{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;align-items:flex-end}
.form-group{display:flex;flex-direction:column;gap:4px}.form-group.grow{flex:1;min-width:140px}
.form-label{font-size:10px;color:var(--text-dim);font-family:var(--font-mono);text-transform:uppercase;letter-spacing:.5px;font-weight:600}
.form-input{padding:9px 12px;background:var(--bg-input);border:1px solid var(--border-light);border-radius:8px;color:var(--text);font-size:13px;font-family:var(--font-display);outline:none}
.form-input:focus{border-color:var(--primary)}
.form-select{padding:9px 12px;background:var(--bg-input);border:1px solid var(--border-light);border-radius:8px;color:var(--text);font-size:13px;font-family:var(--font-display);outline:none;cursor:pointer}
.btn-action{padding:10px 20px;background:var(--primary);color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:700;font-size:13px;white-space:nowrap}
.btn-action:hover{background:var(--primary-dark)}
.btn-edit-sm{padding:5px 12px;background:var(--primary-light);color:var(--primary);border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:11px;margin-right:4px}
.btn-delete-sm{padding:5px 12px;background:var(--danger-light);color:var(--danger);border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:11px}
.btn-save-edit{padding:6px 14px;background:#22c55e;color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;font-size:11px}
.btn-cancel-edit{padding:6px 14px;background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border);border-radius:6px;cursor:pointer;font-weight:600;font-size:11px}
.edit-inline{padding:6px 8px;background:var(--bg-input);border:1px solid var(--primary);border-radius:6px;color:var(--primary);font-size:12px;font-family:var(--font-mono);outline:none;width:100%}
.count-badge{font-family:var(--font-mono);font-size:12px;color:var(--text-dim);background:var(--bg-input);padding:6px 12px;border-radius:8px}
.admin-search-row{display:flex;gap:10px;margin-bottom:16px;align-items:center}.admin-search-row .search-input{margin-bottom:0;flex:1}
.data-table{width:100%;border-collapse:separate;border-spacing:0 3px}
.data-table th{text-align:left;font-size:10px;font-weight:600;color:var(--text-faint);font-family:var(--font-mono);text-transform:uppercase;padding:6px 12px}
.data-table td{padding:10px 12px;font-size:13px;background:var(--bg-panel)}
.data-table tr td:first-child{border-radius:8px 0 0 8px}.data-table tr td:last-child{border-radius:0 8px 8px 0}
.data-table tr:hover td{background:var(--primary-light)}

.dept-chip{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;background:var(--bg-panel);border:1px solid var(--border-light);border-radius:10px;margin:0 6px 6px 0;font-size:13px}
.dept-chip:hover{border-color:var(--primary);background:var(--primary-light)}
.dept-chip .btn-sm{width:22px;height:22px;border-radius:5px;border:none;cursor:pointer;font-size:10px;display:flex;align-items:center;justify-content:center}
.dept-chip .btn-sm.edit{background:var(--primary-light);color:var(--primary)}.dept-chip .btn-sm.del{background:var(--danger-light);color:var(--danger)}
.dept-edit-row{display:inline-flex;align-items:center;gap:6px;padding:5px 10px;background:var(--primary-light);border:1px solid var(--primary);border-radius:10px;margin:0 6px 6px 0}

.logo-config-area{display:flex;gap:20px;margin-top:12px;align-items:flex-start;flex-wrap:wrap}
.logo-controls{flex:1;min-width:260px}
.logo-upload-row{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.logo-preview-box{width:70px;height:70px;border-radius:10px;border:2px dashed var(--border);display:flex;align-items:center;justify-content:center;overflow:hidden;background:var(--bg-input);cursor:pointer;flex-shrink:0}
.logo-preview-box img{width:100%;height:100%;object-fit:cover}
.logo-preview-box .placeholder{color:var(--text-faint);font-size:10px;text-align:center;padding:4px}
.opacity-slider{width:100%;-webkit-appearance:none;height:6px;border-radius:3px;background:var(--border);outline:none;margin-top:6px}
.opacity-slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--primary);cursor:pointer;box-shadow:0 2px 6px rgba(37,99,235,0.3)}
.opacity-value{font-family:var(--font-mono);font-size:14px;color:var(--primary);font-weight:700;min-width:40px;text-align:right}
.btn-remove-logo{padding:5px 12px;background:var(--danger-light);color:var(--danger);border:none;border-radius:6px;cursor:pointer;font-size:11px;font-weight:600;margin-top:8px}

.ticket-live-preview{width:220px;flex-shrink:0;background:#fff;border:1px solid var(--border);border-radius:12px;padding:14px;box-shadow:0 2px 12px rgba(0,0,0,0.06);font-family:var(--font-mono);position:relative;overflow:hidden}
.tlp-watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:130px;height:130px;pointer-events:none;z-index:0}
.tlp-watermark img{width:100%;height:100%;object-fit:contain}
.tlp-body{position:relative;z-index:1}
.tlp-header{text-align:center;border-bottom:1.5px dashed #bbb;padding-bottom:8px;margin-bottom:6px}
.tlp-logo{width:36px;height:36px;border-radius:6px;object-fit:cover;margin:0 auto 4px;display:block}
.tlp-store{font-size:10px;font-weight:700}.tlp-info{font-size:7px;color:#888;margin-top:2px}
.tlp-folio{font-size:7px;font-weight:600;margin-top:4px;background:#f0f0f0;padding:2px 6px;display:inline-block;border-radius:2px}
.tlp-item{display:flex;justify-content:space-between;font-size:7px;padding:2px 0;border-bottom:1px dotted #ddd;color:#444}
.tlp-totals{border-top:1.5px dashed #bbb;padding-top:6px;margin-top:4px}
.tlp-total-row{display:flex;justify-content:space-between;font-size:7px;color:#666;padding:1px 0}
.tlp-grand{display:flex;justify-content:space-between;font-size:11px;font-weight:700;margin-top:3px;padding-top:4px;border-top:1px solid #333}
.tlp-footer{text-align:center;margin-top:8px;border-top:1.5px dashed #bbb;padding-top:6px;font-size:7px;color:#888}
.tlp-footer b{font-size:8px;color:#333;display:block;margin-bottom:2px}
.tlp-badge{position:absolute;top:-1px;right:-1px;background:var(--primary);color:#fff;font-size:8px;font-weight:700;padding:3px 8px;border-radius:0 12px 0 8px;font-family:var(--font-display)}

.emoji-picker-wrap{position:relative;display:inline-block}
.emoji-btn{padding:8px 12px;background:var(--bg-input);border:1px solid var(--border-light);border-radius:8px;cursor:pointer;font-size:18px;line-height:1}
.emoji-dropdown{position:absolute;top:100%;left:0;background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:8px;display:grid;grid-template-columns:repeat(6,1fr);gap:4px;z-index:50;box-shadow:0 10px 30px rgba(0,0,0,0.12);max-height:200px;overflow:auto;width:220px}
.emoji-opt{width:32px;height:32px;border:none;background:none;cursor:pointer;font-size:18px;border-radius:6px;display:flex;align-items:center;justify-content:center}
.emoji-opt:hover{background:var(--primary-light)}

.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(3px)}
.modal-content{background:#fff;border-radius:16px;padding:24px;max-width:420px;width:92%;max-height:90vh;overflow:auto;box-shadow:0 20px 60px rgba(0,0,0,0.15)}
.confirm-modal{background:var(--bg-card);border-radius:16px;padding:24px;max-width:380px;width:92%;box-shadow:0 20px 60px rgba(0,0,0,0.15);border:1px solid var(--border)}
.confirm-title{font-size:17px;font-weight:700;color:var(--danger);margin-bottom:10px}
.confirm-text{font-size:14px;color:var(--text-dim);margin-bottom:18px;line-height:1.5}
.confirm-actions{display:flex;gap:10px}
.btn-confirm-yes{flex:1;padding:11px;background:var(--danger-light);color:var(--danger);border:1px solid #fecaca;border-radius:10px;cursor:pointer;font-weight:700;font-size:13px}
.btn-confirm-no{flex:1;padding:11px;background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border);border-radius:10px;cursor:pointer;font-weight:600;font-size:13px}

.ticket{font-family:var(--font-mono);position:relative}
.ticket-watermark{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:180px;height:180px;pointer-events:none;z-index:0}
.ticket-watermark img{width:100%;height:100%;object-fit:contain}
.ticket-body{position:relative;z-index:1}
.ticket-header{text-align:center;border-bottom:2px dashed #999;padding-bottom:10px;margin-bottom:8px}
.ticket-logo-top{width:60px;height:60px;margin:0 auto 6px;display:block;border-radius:8px;object-fit:cover}
.ticket-store{font-size:16px;font-weight:700;letter-spacing:1px}
.ticket-info{font-size:10px;color:#555;margin-top:4px;line-height:1.5}
.ticket-folio{font-size:11px;font-weight:600;margin-top:6px;background:#f0f0f0;padding:3px 8px;display:inline-block;border-radius:3px}
.ticket-date{font-size:10px;color:#555;margin-top:4px}
.ticket-table{width:100%;border-collapse:collapse;margin:8px 0}
.ticket-table th{text-align:left;font-size:9px;font-weight:600;border-bottom:1px solid #333;padding:3px 2px;text-transform:uppercase}
.ticket-table th.r,.ticket-table td.r{text-align:right}
.ticket-table td{padding:4px 2px;font-size:10px;border-bottom:1px dotted #ccc}
.ticket-totals{border-top:2px dashed #999;padding-top:8px;margin-top:4px}
.ticket-total-row{display:flex;justify-content:space-between;padding:2px 0;font-size:11px}
.ticket-total-grand{display:flex;justify-content:space-between;padding:6px 0 2px;font-size:18px;font-weight:700;border-top:1px solid #333;margin-top:4px}
.ticket-footer{text-align:center;margin-top:12px;border-top:2px dashed #999;padding-top:10px}
.ticket-footer .thanks{font-size:13px;font-weight:700;margin-bottom:4px}
.ticket-footer p{font-size:9px;color:#555;line-height:1.5}
.modal-actions{display:flex;gap:10px;margin-top:18px}
.btn-print{flex:1;padding:11px;background:var(--primary);color:#fff;border:none;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;font-family:var(--font-mono)}
.btn-close-modal{flex:1;padding:11px;background:var(--bg-input);color:var(--text-dim);border:1px solid var(--border);border-radius:10px;font-size:13px;font-weight:600;cursor:pointer}

.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--bg-card);color:var(--primary);border:1px solid var(--primary-light);padding:10px 22px;border-radius:10px;font-weight:600;font-size:13px;z-index:2000;box-shadow:0 8px 24px rgba(0,0,0,0.1);animation:toastIn .3s ease,toastOut .3s ease 2.2s forwards}
@keyframes toastIn{from{opacity:0;transform:translateX(-50%) translateY(20px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
@keyframes toastOut{from{opacity:1}to{opacity:0}}
.hidden{display:none!important}

body.printing>*{display:none!important}
body.printing #ticket-modal{display:block!important;position:static!important;background:none!important;backdrop-filter:none!important;padding:0!important;margin:0!important}
body.printing #ticket-modal .modal-content{box-shadow:none;max-height:none;border-radius:0;padding:0;margin:0}
body.printing #ticket-modal .modal-actions{display:none!important}
body.printing .toast{display:none!important}
.loading-screen{position:fixed;inset:0;background:var(--bg);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:9999}
.loading-screen .spinner{width:40px;height:40px;border:4px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-screen p{margin-top:14px;color:var(--text-dim);font-size:14px}
@media(max-width:768px){.pos-layout{flex-direction:column;height:auto}.order-panel{width:100%;min-height:300px}.product-grid{grid-template-columns:repeat(auto-fill,minmax(160px,1fr))}.header{flex-wrap:wrap;gap:6px}.header-date{display:none}.form-row{flex-direction:column}.logo-config-area{flex-direction:column}.ticket-live-preview{width:100%}}
</style>
</head>
<body>

<div class="loading-screen" id="loading"><div class="spinner"></div><p>Conectando a Firebase...</p></div>

<header class="header">
  <div class="header-brand">
    <img class="hdr-logo" id="hdr-logo-img" src="" alt="" style="display:none">
    <div><div class="header-title">Punto de Venta</div><div class="header-sub" id="hdr-biz-name">ADMIN</div></div>
  </div>
  <nav class="header-nav">
    <button class="nav-btn active" onclick="switchView('pos')" id="nav-pos">ğŸ’° Venta</button>
    <button class="nav-btn" onclick="switchView('history')" id="nav-history">ğŸ“‹ Historial</button>
    <button class="nav-btn" onclick="switchView('admin')" id="nav-admin">âš™ï¸ ConfiguraciÃ³n</button>
  </nav>
  <div class="header-date"><span><span class="sync-dot" id="sync-dot"></span><span id="sync-label">Desconectado</span></span><small id="current-date"></small></div>
</header>

<div id="view-pos" class="pos-layout">
  <div class="products-panel">
    <input type="text" class="search-input" placeholder="ğŸ” Buscar producto..." id="product-search" oninput="renderProducts()">
    <div class="categories" id="categories-bar"></div>
    <div class="product-grid" id="product-grid"></div>
  </div>
  <div class="order-panel">
    <div class="order-header"><span>ğŸ“ Lista de Venta</span><span class="order-count" id="order-count">0</span></div>
    <div class="order-items" id="order-items"></div>
    <div class="totals-section">
      <div class="total-row"><span>Subtotal:</span><span id="subtotal">$0.00</span></div>
      <div class="total-grand"><span>TOTAL:</span><span id="total">$0.00</span></div>
      <div class="action-buttons">
        <button class="btn-cancel" id="btn-cancel" disabled onclick="cancelOrder()">ğŸ—‘ Cancelar</button>
        <button class="btn-charge" id="btn-charge" disabled onclick="completeSale()">ğŸ’° COBRAR</button>
      </div>
    </div>
  </div>
</div>

<div id="view-history" class="scroll-view hidden">
  <div class="view-title">ğŸ“‹ Historial <span class="count" id="history-count"></span></div>
  <input type="text" class="search-input" placeholder="ğŸ” Buscar..." id="history-search" oninput="renderHistory()">
  <div id="history-list"></div>
</div>

<div id="view-admin" class="scroll-view hidden">
  <div class="view-title">âš™ï¸ ConfiguraciÃ³n</div>
  <div class="admin-section">
    <div class="admin-section-title">ğŸª Datos del Negocio</div>
    <div class="form-row">
      <div class="form-group grow"><label class="form-label">Nombre</label><input type="text" class="form-input" id="biz-name" placeholder="Ej: Abarrotes Don Pepe" onchange="saveBiz()"></div>
      <div class="form-group grow"><label class="form-label">DirecciÃ³n</label><input type="text" class="form-input" id="biz-address" placeholder="DirecciÃ³n" onchange="saveBiz()"></div>
    </div>
    <div class="form-row">
      <div class="form-group grow"><label class="form-label">TelÃ©fono</label><input type="text" class="form-input" id="biz-phone" placeholder="(555) 123-4567" onchange="saveBiz()"></div>
    </div>
    <label class="form-label" style="margin-top:12px">Logotipo y Marca de Agua</label>
    <div class="logo-config-area">
      <div class="ticket-live-preview" id="live-preview"></div>
      <div class="logo-controls">
        <div class="logo-upload-row">
          <div class="logo-preview-box" onclick="$('logo-file-input').click()"><span class="placeholder" id="logo-placeholder">Clic para subir</span><img id="logo-img" src="" style="display:none"></div>
          <input type="file" id="logo-file-input" accept="image/*" style="display:none" onchange="handleLogo(event)">
          <div style="flex:1"><div style="font-size:13px;font-weight:600">Subir logotipo</div><div style="font-size:11px;color:var(--text-faint);margin-top:2px">JPG, PNG o SVG</div><button class="btn-remove-logo hidden" id="btn-remove-logo" onclick="removeLogo()">âœ• Quitar</button></div>
        </div>
        <label class="form-label">Transparencia</label>
        <div style="display:flex;align-items:center;gap:10px;margin-top:4px">
          <span style="font-size:11px;color:var(--text-faint)">0%</span>
          <input type="range" min="0" max="100" value="15" class="opacity-slider" id="logo-opacity" oninput="updatePreview()" onchange="saveBiz()">
          <span style="font-size:11px;color:var(--text-faint)">100%</span>
          <span class="opacity-value" id="opacity-label">15%</span>
        </div>
      </div>
    </div>
  </div>

  <div class="admin-section">
    <div class="admin-section-title"><span>ğŸ·ï¸ Departamentos</span><span class="count-badge" id="dept-count">0</span></div>
    <div class="form-row">
      <div class="form-group"><label class="form-label">Icono</label><div class="emoji-picker-wrap"><button class="emoji-btn" id="new-dept-icon-btn" onclick="toggleEmoji('new-dept')">ğŸª</button><div class="emoji-dropdown hidden" id="emoji-picker-new-dept"></div></div></div>
      <div class="form-group grow"><label class="form-label">Nombre</label><input type="text" class="form-input" id="new-dept-name" placeholder="Ej: Carnes, LÃ¡cteos..."></div>
      <div class="form-group"><label class="form-label">&nbsp;</label><button class="btn-action" onclick="addDept()">â• Agregar</button></div>
    </div>
    <div id="dept-list" style="margin-top:8px"></div>
  </div>

  <div class="admin-section">
    <div class="admin-section-title"><span>ğŸ“¦ Productos</span><span class="count-badge" id="admin-product-count">0</span></div>
    <div class="form-row">
      <div class="form-group grow"><label class="form-label">Nombre</label><input type="text" class="form-input" id="new-name" placeholder="Producto"></div>
      <div class="form-group"><label class="form-label">Precio</label><input type="number" class="form-input" id="new-price" placeholder="0.00" step="0.5" min="0" style="width:100px"></div>
      <div class="form-group"><label class="form-label">Unidad</label><select class="form-select" id="new-unit" style="width:95px"><option value="kg">âš–ï¸ Kg</option><option value="pza">ğŸ“¦ Pza</option></select></div>
      <div class="form-group"><label class="form-label">Depto</label><select class="form-select" id="new-category"></select></div>
      <div class="form-group"><label class="form-label">&nbsp;</label><button class="btn-action" onclick="addProduct()">â• Agregar</button></div>
    </div>
    <div class="admin-search-row" style="margin-top:8px">
      <input type="text" class="search-input" placeholder="ğŸ” Buscar..." id="admin-search" oninput="renderAdminProducts()">
      <select class="form-select" id="admin-filter-cat" onchange="renderAdminProducts()" style="width:150px"></select>
    </div>
    <div id="admin-product-list" style="overflow-x:auto"></div>
  </div>
</div>

<div class="modal-overlay hidden" id="ticket-modal" onclick="closeTicket()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div id="ticket-content"></div>
    <div class="modal-actions"><button class="btn-print" onclick="printTicket()">ğŸ–¨ï¸ IMPRIMIR</button><button class="btn-close-modal" onclick="closeTicket()">CERRAR</button></div>
  </div>
</div>

<div class="modal-overlay hidden" id="confirm-modal" onclick="closeConfirm()">
  <div class="confirm-modal" onclick="event.stopPropagation()">
    <div class="confirm-title" id="confirm-title">ğŸ—‘ Eliminar</div>
    <div class="confirm-text" id="confirm-text"></div>
    <div class="confirm-actions"><button class="btn-confirm-no" onclick="closeConfirm()">Cancelar</button><button class="btn-confirm-yes" id="btn-confirm-yes">SÃ­, eliminar</button></div>
  </div>
</div>

<script>
// =============================================
// ğŸ”¥ FIREBASE CONFIG - REEMPLAZA CON TU CONFIG
// =============================================
const firebaseConfig = {
  apiKey: "AIzaSyDinSBMa6cxp63gxaSZfsbRxDxq_fb6UoM",
  authDomain: "tickets-bdae7.firebaseapp.com",
  projectId: "tickets-bdae7",
  storageBucket: "tickets-bdae7.firebasestorage.app",
  messagingSenderId: "1050980749413",
  appId: "1:1050980749413:web:be239c8f087d268227768c"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// COLLECTIONS
const bizRef = db.collection("config").doc("business");
const catsRef = db.collection("categories");
const prodsRef = db.collection("products");
const salesRef = db.collection("sales");

// STATE
const EMOJIS=["ğŸª","ğŸ","ğŸ¥¬","ğŸ¥©","ğŸ§€","ğŸ›’","ğŸ¥¤","ğŸ§¹","ğŸ§´","ğŸŸ","ğŸ","ğŸ¥š","ğŸŒ¶ï¸","ğŸ«˜","ğŸ¥«","ğŸ¬","ğŸº","ğŸ§Š","ğŸ”","ğŸ·","ğŸ„","ğŸ¥›","ğŸ•","ğŸ ","ğŸ”§","ğŸ’Š","ğŸ§¸","ğŸ“¦","ğŸ","âœ¨","ğŸŒ®","ğŸ¥‘","ğŸŒ","ğŸŠ","ğŸ«’","ğŸ—","ğŸ§ˆ","ğŸš","ğŸ¥œ","â˜•"];
let biz={name:"",address:"",phone:"",logo:"",logoOpacity:15};
let categories=[],products=[],salesHistory=[],orderItems=[];
let currentView="pos",selectedCat="all",currentTicketSale=null,editingProdId=null,editingDeptId=null,newDeptIcon="ğŸª";

// HELPERS
function fmt(n){return"$"+n.toFixed(2)}
function fmtDate(d){return new Date(d).toLocaleString("es-MX",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}
function mkFolio(){const d=new Date(),p=(n,l=2)=>String(n).padStart(l,"0");return`V-${d.getFullYear()}${p(d.getMonth()+1)}${p(d.getDate())}-${p(Math.floor(Math.random()*9999),4)}`}
function $(id){return document.getElementById(id)}
function getCat(id){return categories.find(x=>x.id===id)}
function getCatLabel(id){const c=getCat(id);return c?c.icon+" "+c.name:"â€”"}
function toast(m){const e=document.createElement("div");e.className="toast";e.textContent=m;document.body.appendChild(e);setTimeout(()=>e.remove(),2600)}

// =============================================
// ğŸ”¥ FIREBASE REAL-TIME LISTENERS
// =============================================
function startListeners(){
  // Business config
  bizRef.onSnapshot(doc=>{
    if(doc.exists){const d=doc.data();biz={name:d.name||"",address:d.address||"",phone:d.phone||"",logo:d.logo||"",logoOpacity:d.logoOpacity??15}}
    updateHeader();if(currentView==="admin"){loadBizUI();updatePreview()}
  });

  // Categories
  catsRef.orderBy("name").onSnapshot(snap=>{
    categories=snap.docs.map(d=>({id:d.id,...d.data()}));
    renderCategories();refreshCatSelects();if(currentView==="admin")renderDepts();
  });

  // Products
  prodsRef.orderBy("name").onSnapshot(snap=>{
    products=snap.docs.map(d=>({id:d.id,...d.data()}));
    renderProducts();if(currentView==="admin")renderAdminProducts();
  });

  // Sales
  salesRef.orderBy("date","desc").limit(200).onSnapshot(snap=>{
    salesHistory=snap.docs.map(d=>({id:d.id,...d.data()}));
    if(currentView==="history")renderHistory();
  });

  // Connection status
  $("sync-dot").classList.add("on");
  $("sync-label").textContent="Conectado";
  $("loading").classList.add("hidden");
}

// =============================================
// BUSINESS
// =============================================
function saveBiz(){
  biz.name=$("biz-name").value;biz.address=$("biz-address").value;biz.phone=$("biz-phone").value;biz.logoOpacity=parseInt($("logo-opacity").value);
  bizRef.set(biz).then(()=>toast("âœ… Guardado")).catch(e=>toast("âš ï¸ Error: "+e.message));
  updateHeader();
}
function loadBizUI(){$("biz-name").value=biz.name;$("biz-address").value=biz.address;$("biz-phone").value=biz.phone;$("logo-opacity").value=biz.logoOpacity;if(biz.logo){$("logo-img").src=biz.logo;$("logo-img").style.display="block";$("logo-placeholder").style.display="none";$("btn-remove-logo").classList.remove("hidden")}else{$("logo-img").style.display="none";$("logo-placeholder").style.display="block";$("btn-remove-logo").classList.add("hidden")}}
function updateHeader(){$("hdr-biz-name").textContent=biz.name?"ADMIN Â· "+biz.name:"ADMIN";if(biz.logo){$("hdr-logo-img").src=biz.logo;$("hdr-logo-img").style.display="block"}else $("hdr-logo-img").style.display="none"}
function handleLogo(e){const f=e.target.files[0];if(!f)return;if(f.size>500000){toast("âš ï¸ Logo muy grande (mÃ¡x 500KB)");return}const r=new FileReader();r.onload=ev=>{biz.logo=ev.target.result;$("logo-img").src=biz.logo;$("logo-img").style.display="block";$("logo-placeholder").style.display="none";$("btn-remove-logo").classList.remove("hidden");saveBiz();updatePreview()};r.readAsDataURL(f)}
function removeLogo(){biz.logo="";$("logo-img").style.display="none";$("logo-placeholder").style.display="block";$("btn-remove-logo").classList.add("hidden");saveBiz();updatePreview()}
function updatePreview(){const op=parseInt($("logo-opacity").value);$("opacity-label").textContent=op+"%";const name=biz.name||"Tu Negocio";const info=[biz.address||"DirecciÃ³n",biz.phone?"Tel: "+biz.phone:""].filter(Boolean).join(" Â· ");const lt=biz.logo?`<img class="tlp-logo" src="${biz.logo}">`:"";const wm=biz.logo?`<div class="tlp-watermark"><img src="${biz.logo}" style="opacity:${op/100}"></div>`:"";$("live-preview").innerHTML=`<div class="tlp-badge">Vista previa</div>${wm}<div class="tlp-body"><div class="tlp-header">${lt}<div class="tlp-store">${name}</div><div class="tlp-info">${info}</div><div class="tlp-folio">V-20260226-0001</div></div><div style="margin:6px 0"><div class="tlp-item"><span>Producto ejemplo</span><span>$45.00</span></div><div class="tlp-item"><span>Producto ejemplo 2</span><span>$28.50</span></div></div><div class="tlp-totals"><div class="tlp-grand"><span>TOTAL:</span><span>$73.50</span></div></div><div class="tlp-footer"><b>Â¡Gracias!</b>Conserve su ticket.</div></div>`}

// VIEWS
function switchView(v){currentView=v;["pos","history","admin"].forEach(x=>{$("view-"+x).classList.toggle("hidden",x!==v);$("nav-"+x).classList.toggle("active",x===v)});if(v==="admin"){loadBizUI();updatePreview();renderAdmin()}if(v==="pos"){renderCategories();renderProducts()}}

// EMOJI
function toggleEmoji(t){const dd=$("emoji-picker-"+t),o=!dd.classList.contains("hidden");document.querySelectorAll(".emoji-dropdown").forEach(e=>e.classList.add("hidden"));if(o)return;dd.innerHTML=EMOJIS.map(e=>`<button class="emoji-opt" onclick="pickEmoji('${t}','${e}')">${e}</button>`).join("");dd.classList.remove("hidden")}
function pickEmoji(t,e){if(t==="new-dept"){newDeptIcon=e;$("new-dept-icon-btn").textContent=e}else{const b=$("edb-"+t.replace("edit-dept-",""));if(b){b.textContent=e;b.dataset.icon=e}}document.querySelectorAll(".emoji-dropdown").forEach(x=>x.classList.add("hidden"))}
document.addEventListener("click",e=>{if(!e.target.closest(".emoji-picker-wrap"))document.querySelectorAll(".emoji-dropdown").forEach(x=>x.classList.add("hidden"))});

// DEPARTMENTS
function renderDepts(){$("dept-count").textContent=categories.length;if(!categories.length){$("dept-list").innerHTML=`<div style="text-align:center;padding:20px;color:var(--text-faint)">Agrega tu primer departamento â˜ï¸</div>`;return}let h="";categories.forEach(c=>{if(editingDeptId===c.id){h+=`<span class="dept-edit-row"><div class="emoji-picker-wrap"><button class="emoji-btn" id="edb-${c.id}" data-icon="${c.icon}" onclick="toggleEmoji('edit-dept-${c.id}')" style="padding:4px 8px">${c.icon}</button><div class="emoji-dropdown hidden" id="emoji-picker-edit-dept-${c.id}"></div></div><input class="edit-inline" id="edn-${c.id}" value="${c.name}" style="width:120px"><button class="btn-save-edit" onclick="saveDeptEdit('${c.id}')">âœ“</button><button class="btn-cancel-edit" onclick="editingDeptId=null;renderDepts()">âœ•</button></span>`}else{h+=`<span class="dept-chip"><span style="font-size:16px">${c.icon}</span><span style="font-weight:600">${c.name}</span><span style="display:flex;gap:3px;margin-left:6px"><button class="btn-sm edit" onclick="editingDeptId='${c.id}';renderDepts()">âœï¸</button><button class="btn-sm del" onclick="confirmDelDept('${c.id}')">âœ•</button></span></span>`}});$("dept-list").innerHTML=h}
function addDept(){const n=$("new-dept-name").value.trim();if(!n){toast("âš ï¸ Nombre vacÃ­o");return}catsRef.add({name:n,icon:newDeptIcon}).then(()=>{$("new-dept-name").value="";newDeptIcon="ğŸª";$("new-dept-icon-btn").textContent="ğŸª";toast("âœ… Depto: "+n)}).catch(e=>toast("âš ï¸ "+e.message))}
function saveDeptEdit(id){const n=$("edn-"+id).value.trim();const b=$("edb-"+id);const icon=b?b.dataset.icon||b.textContent:"ğŸª";if(!n){toast("âš ï¸ VacÃ­o");return}catsRef.doc(id).update({name:n,icon}).then(()=>{editingDeptId=null;toast("âœ… Actualizado")}).catch(e=>toast("âš ï¸ "+e.message))}
function confirmDelDept(id){const c=getCat(id);if(!c)return;$("confirm-title").textContent="ğŸ—‘ Eliminar Departamento";$("confirm-text").textContent=`Â¿Eliminar "${c.icon} ${c.name}"?`;$("btn-confirm-yes").onclick=()=>{catsRef.doc(id).delete();closeConfirm();toast("ğŸ—‘ Eliminado")};$("confirm-modal").classList.remove("hidden")}
function refreshCatSelects(){let o="",f=`<option value="all">Todos</option>`;categories.forEach(c=>{o+=`<option value="${c.id}">${c.icon} ${c.name}</option>`;f+=`<option value="${c.id}">${c.icon} ${c.name}</option>`});$("new-category").innerHTML=o||`<option value="">â€”</option>`;if($("admin-filter-cat"))$("admin-filter-cat").innerHTML=f}

// CATEGORIES BAR
function renderCategories(){let h=`<button class="cat-btn ${selectedCat==='all'?'active':''}" onclick="selectedCat='all';renderCategories();renderProducts()">ğŸª Todos</button>`;categories.forEach(c=>{h+=`<button class="cat-btn ${selectedCat===c.id?'active':''}" onclick="selectedCat='${c.id}';renderCategories();renderProducts()">${c.icon} ${c.name}</button>`});$("categories-bar").innerHTML=h}

// PRODUCTS
function renderProducts(){const s=$("product-search").value.toLowerCase(),f=products.filter(p=>(selectedCat==="all"||p.category===selectedCat)&&p.name.toLowerCase().includes(s));if(!products.length){$("product-grid").innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:70px;color:var(--text-faint)"><div style="font-size:50px;opacity:.3">ğŸ“¦</div><div style="font-size:14px;margin-top:10px">No hay productos</div></div>`;return}if(!f.length){$("product-grid").innerHTML=`<div style="grid-column:1/-1;text-align:center;padding:50px;color:var(--text-faint)">ğŸ” Sin resultados</div>`;return}$("product-grid").innerHTML=f.map(p=>`<div class="product-card"><div class="product-top"><div><div class="product-name">${p.name}</div><div class="product-price">${fmt(p.price)}/${p.unit}</div></div><span class="unit-badge ${p.unit}">${p.unit==="kg"?"âš–ï¸ KG":"ğŸ“¦ PZA"}</span></div><div class="product-actions"><input type="number" class="qty-input" id="qty-${p.id}" step="${p.unit==='kg'?'0.1':'1'}" min="0" placeholder="${p.unit==='kg'?'Kg':'Cant.'}" onkeydown="if(event.key==='Enter')addToOrder('${p.id}')"><button class="add-btn" onclick="addToOrder('${p.id}')">+</button></div></div>`).join("")}

// ORDER
function addToOrder(id){const p=products.find(x=>x.id===id);if(!p)return;const el=$("qty-"+id),qty=parseFloat(el.value)||(p.unit==="kg"?1:1);const ex=orderItems.find(i=>i.pid===id);if(ex){ex.qty+=qty;ex.total=ex.qty*ex.price}else orderItems.push({pid:p.id,name:p.name,price:p.price,unit:p.unit,qty,total:qty*p.price});el.value="";renderOrder()}
function updateQty(id,q){if(q<=0){orderItems=orderItems.filter(i=>i.pid!==id);renderOrder();return}const i=orderItems.find(x=>x.pid===id);if(i){i.qty=parseFloat(q.toFixed(2));i.total=i.qty*i.price;renderOrder()}}
function cancelOrder(){orderItems=[];renderOrder()}
function renderOrder(){const n=orderItems.length;$("order-count").textContent=n;$("btn-cancel").disabled=!n;$("btn-charge").disabled=!n;if(!n){$("order-items").innerHTML=`<div class="order-empty"><div style="font-size:44px;opacity:.25">ğŸ›’</div><div style="font-size:13px;margin-top:8px">Agrega productos</div></div>`}else{$("order-items").innerHTML=orderItems.map((it,i)=>{const st=it.unit==="kg"?0.1:1;return`<div class="order-item"><div class="order-item-top"><div><div class="order-item-name">${i+1}. ${it.name}</div><div class="order-item-price">${fmt(it.price)}/${it.unit}</div></div><button class="remove-btn" onclick="orderItems=orderItems.filter(x=>x.pid!=='${it.pid}');renderOrder()">âœ•</button></div><div class="order-item-bottom"><div class="qty-controls"><button class="qty-ctrl-btn" onclick="updateQty('${it.pid}',${it.qty}-${st})">âˆ’</button><input type="number" class="qty-edit" value="${it.qty.toFixed(2)}" onchange="updateQty('${it.pid}',parseFloat(this.value)||0)"><span class="qty-unit">${it.unit}</span><button class="qty-ctrl-btn" onclick="updateQty('${it.pid}',${it.qty}+${st})">+</button></div><div class="order-item-total">${fmt(it.total)}</div></div></div>`}).join("")}const sub=orderItems.reduce((s,i)=>s+i.total,0);$("subtotal").textContent=fmt(sub);$("total").textContent=fmt(sub)}

// SALE
function completeSale(){if(!orderItems.length)return;const sub=orderItems.reduce((s,i)=>s+i.total,0);const sale={folio:mkFolio(),date:new Date().toISOString(),items:orderItems.map(i=>({name:i.name,price:i.price,unit:i.unit,qty:i.qty,total:i.total})),subtotal:sub,total:sub,source:"admin"};salesRef.add(sale).then(()=>{showTicket(sale);orderItems=[];renderOrder();toast("âœ… Venta registrada")}).catch(e=>toast("âš ï¸ "+e.message))}

// TICKET
function showTicket(sale){currentTicketSale=sale;const tot=sale.total;let rows=sale.items.map(i=>`<tr><td>${i.name}</td><td class="r">${i.qty} ${i.unit}</td><td class="r">${fmt(i.price)}</td><td class="r">${fmt(i.total)}</td></tr>`).join("");const lt=biz.logo?`<img class="ticket-logo-top" src="${biz.logo}">`:"";const wm=biz.logo?`<div class="ticket-watermark"><img src="${biz.logo}" style="opacity:${biz.logoOpacity/100}"></div>`:"";const sn=biz.name||"Punto de Venta";const inf=[biz.address,biz.phone?"Tel: "+biz.phone:""].filter(Boolean).join(" | ");$("ticket-content").innerHTML=`<div class="ticket">${wm}<div class="ticket-body"><div class="ticket-header">${lt}<div class="ticket-store">${sn}</div>${inf?`<div class="ticket-info">${inf}</div>`:""}<div class="ticket-folio">${sale.folio}</div><div class="ticket-date">${fmtDate(sale.date)}</div></div><table class="ticket-table"><thead><tr><th>Producto</th><th class="r">Cant.</th><th class="r">P.U.</th><th class="r">Imp.</th></tr></thead><tbody>${rows}</tbody></table><div class="ticket-totals"><div class="ticket-total-grand"><span>TOTAL:</span><span>${fmt(tot)}</span></div></div><div class="ticket-footer"><div class="thanks">Â¡Gracias por su compra!</div><p>ArtÃ­culos: ${sale.items.length}</p></div></div></div>`;$("ticket-modal").classList.remove("hidden")}
function closeTicket(){$("ticket-modal").classList.add("hidden")}
function printTicket(){document.body.classList.add("printing");setTimeout(function(){window.print();document.body.classList.remove("printing")},100)}

// HISTORY
function renderHistory(){const s=$("history-search").value.toLowerCase(),f=salesHistory.filter(x=>x.folio.toLowerCase().includes(s)||x.items.some(i=>i.name.toLowerCase().includes(s)));$("history-count").textContent=salesHistory.length+" ventas";if(!f.length){$("history-list").innerHTML=`<div style="text-align:center;padding:70px;color:var(--text-faint)"><div style="font-size:50px;opacity:.25">ğŸ“‹</div><div style="font-size:14px;margin-top:10px">${!salesHistory.length?"Sin ventas aÃºn":"Sin resultados"}</div></div>`;return}$("history-list").innerHTML=f.map((s,i)=>`<div class="sale-card" onclick="showTicket(salesHistory[${salesHistory.indexOf(s)}])"><div><div class="sale-folio">${s.folio} ${s.source==='terminal'?'ğŸ“±':''}</div><div class="sale-date">${fmtDate(s.date)}</div><div class="sale-products">${s.items.map(i=>i.name).join(" Â· ")}</div></div><div><div class="sale-total">${fmt(s.total)}</div><div class="sale-view-link">Ver ticket â†’</div></div></div>`).join("")}

// ADMIN PRODUCTS
function renderAdmin(){refreshCatSelects();renderDepts();renderAdminProducts()}
function renderAdminProducts(){const s=($("admin-search")?$("admin-search").value:"").toLowerCase(),fc=$("admin-filter-cat")?$("admin-filter-cat").value:"all",f=products.filter(p=>(fc==="all"||p.category===fc)&&p.name.toLowerCase().includes(s));$("admin-product-count").textContent=products.length;if(!products.length){$("admin-product-list").innerHTML=`<div style="text-align:center;padding:36px;color:var(--text-faint)">${categories.length?"Agrega productos â˜ï¸":"Primero agrega un departamento"}</div>`;return}if(!f.length){$("admin-product-list").innerHTML=`<div style="text-align:center;padding:24px;color:var(--text-faint)">Sin resultados</div>`;return}$("admin-product-list").innerHTML=`<table class="data-table"><thead><tr><th>#</th><th>Producto</th><th>Precio</th><th>Unidad</th><th>Depto</th><th>Acciones</th></tr></thead><tbody>${f.map((p,i)=>`<tr><td style="color:var(--primary);font-family:var(--font-mono);font-size:11px">${i+1}</td><td style="font-weight:600">${p.name}</td><td style="font-family:var(--font-mono);color:var(--primary)">${fmt(p.price)}</td><td><span class="unit-badge ${p.unit}">${p.unit==="kg"?"âš–ï¸ KG":"ğŸ“¦ PZA"}</span></td><td style="font-size:12px;color:var(--text-dim)">${getCatLabel(p.category)}</td><td><button class="btn-edit-sm" onclick="editProd('${p.id}')">âœï¸</button><button class="btn-delete-sm" onclick="confirmDelProd('${p.id}')">ğŸ—‘</button></td></tr>`).join("")}</tbody></table>`}
function addProduct(){const name=$("new-name").value.trim(),price=parseFloat($("new-price").value),unit=$("new-unit").value,cat=$("new-category").value;if(!name){toast("âš ï¸ Nombre");return}if(!price||price<=0){toast("âš ï¸ Precio");return}if(!cat){toast("âš ï¸ Depto");return}prodsRef.add({name,price,unit,category:cat}).then(()=>{$("new-name").value="";$("new-price").value="";toast("âœ… "+name)}).catch(e=>toast("âš ï¸ "+e.message))}
function editProd(id){const p=products.find(x=>x.id===id);if(!p)return;const name=prompt("Nombre:",p.name);if(!name)return;const price=parseFloat(prompt("Precio:",p.price));if(!price)return;prodsRef.doc(id).update({name,price}).then(()=>toast("âœ… Actualizado"))}
function confirmDelProd(id){const p=products.find(x=>x.id===id);if(!p)return;$("confirm-title").textContent="ğŸ—‘ Eliminar";$("confirm-text").textContent=`Â¿Eliminar "${p.name}"?`;$("btn-confirm-yes").onclick=()=>{prodsRef.doc(id).delete();closeConfirm();toast("ğŸ—‘ Eliminado")};$("confirm-modal").classList.remove("hidden")}
function closeConfirm(){$("confirm-modal").classList.add("hidden")}

// INIT
$("current-date").textContent=new Date().toLocaleDateString("es-MX",{weekday:"short",day:"numeric",month:"short"});
renderOrder();
startListeners();
</script>
</body>
</html>
